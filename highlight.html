<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç›¸äº’ãƒã‚¤ãƒ©ã‚¤ãƒˆå‹•çš„å…¥åŠ›ç‰ˆ</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      background: #fdfdfd;
    }
    .prompt-group {
      margin-bottom: 1.5em;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1em;
      background: #fff;
    }
    .group-title {
      font-weight: bold;
      margin-bottom: 0.5em;
    }
    .pair {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 0.2em;
      margin-bottom: 0;
      background: #f7f7f7;
      border-radius: 4px;
      padding: 2px 4px;
    }
    .word {
      padding: 2px 5px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 1em;
    }
    .en-word {
      color: #1565c0;
      font-weight: bold;
    }
    .paren {
      color: #388e3c;
      font-weight: bold;
    }
    .non-latin {
      color: #222;
      font-weight: normal;
    }
    .highlight {
      background-color: #fffa8b;
    }
    .input-group {
      display: flex;
      gap: 0.5em;
      margin-bottom: 0.5em;
    }
    input {
      padding: 0.5em;
      font-size: 1em;
      flex: 1;
    }
    button {
      padding: 0.3em 0.8em;
      font-size: 1em;
    }
    .output {
      margin-top: 1em;
      display: flex;
      flex-wrap: wrap;
      gap: 0.2em;
    }
    .all-output {
      margin-top: 2em;
    }
  </style>
</head>
<body>

  <h2>ğŸ“ å˜èªãƒšã‚¢ã‚’å…¥åŠ›ã—ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼†ç·¨é›†ï¼</h2>

  <div id="groups"></div>

  <div class="all-output">
    <button id="allPromptBtn" onclick="showAllPrompt()">å…¨ãƒªã‚¹ãƒˆåˆæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ›</button>
    <textarea id="allPromptArea" rows="3" style="width:100%;margin-top:0.5em;"></textarea>
  </div>

  <script>
    // --- è¨­å®š ---
    const GROUPS = [
      { name: 'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼', id: 'group1' },
      { name: 'èƒŒæ™¯', id: 'group2' },
      { name: 'ãã®ä»–', id: 'group3' }
    ];
    // --- çŠ¶æ…‹ç®¡ç† ---
    let idCounter = 1;
    const groupData = {
      group1: [],
      group2: [],
      group3: []
    };

    // --- UIç”Ÿæˆ ---
    function renderGroups() {
      const groupsDiv = document.getElementById('groups');
      groupsDiv.innerHTML = '';
      GROUPS.forEach(group => {
        const gDiv = document.createElement('div');
        gDiv.className = 'prompt-group';
        gDiv.id = group.id + '-container';
        gDiv.innerHTML = `
          <div class="group-title">${group.name}</div>
          <div class="input-group">
            <input type="text" id="${group.id}-en" placeholder="è‹±èªå…¥åŠ›">
            <input type="text" id="${group.id}-ja" placeholder="æ—¥æœ¬èªå…¥åŠ›">
            <button onclick="addPair('${group.id}')">è¿½åŠ </button>
          </div>
          <div class="output" id="${group.id}-output"></div>
          <button id="${group.id}-promptBtn" onclick="showPrompt('${group.id}')">è‹±æ–‡ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ›</button>
          <textarea id="${group.id}-promptArea" rows="2" style="width:100%;margin-top:0.5em;"></textarea>
        `;
        groupsDiv.appendChild(gDiv);
      });
    }
    renderGroups();

    // --- ãƒšã‚¢è¿½åŠ  ---
    function addPair(groupId) {
      let enText = document.getElementById(`${groupId}-en`).value.trim();
      let jaText = document.getElementById(`${groupId}-ja`).value.trim();
      if (!enText || !jaText) return;
      const delimiterRegex = /[,ã€ï¼Œ]/; // ãƒ‰ãƒƒãƒˆã‚’é™¤å¤–
      const enWords = enText.split(delimiterRegex).map(w => w.trim()).filter(Boolean);
      const jaWords = jaText.split(delimiterRegex).map(w => w.trim()).filter(Boolean);
      const pairCount = Math.min(enWords.length, jaWords.length);
      for (let i = 0; i < pairCount; i++) {
        groupData[groupId].push({
          id: idCounter,
          en: enWords[i],
          ja: jaWords[i]
        });
        idCounter++;
      }
      document.getElementById(`${groupId}-en`).value = '';
      document.getElementById(`${groupId}-ja`).value = '';
      renderPairs(groupId);
    }

    // --- ãƒšã‚¢è¡¨ç¤ºãƒ»å‰Šé™¤ ---
    function renderPairs(groupId) {
      const outputDiv = document.getElementById(`${groupId}-output`);
      outputDiv.innerHTML = '';
      groupData[groupId].forEach(pair => {
        const pairDiv = document.createElement('div');
        pairDiv.className = 'pair';
        pairDiv.dataset.id = pair.id;
        // è‹±å˜èªã®è‰²åˆ†ã‘å‡¦ç†
        const enSpan = document.createElement('span');
        enSpan.className = 'word en-word';
        enSpan.dataset.id = pair.id;
        enSpan.innerHTML = highlightEnWord(pair.en);
        // ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§å‰Šé™¤
        enSpan.ondblclick = function() {
          groupData[groupId] = groupData[groupId].filter(p => p.id !== pair.id);
          renderPairs(groupId);
        };
        // æ—¥æœ¬èªå´
        const jaSpan = document.createElement('span');
        jaSpan.className = 'word';
        jaSpan.dataset.id = pair.id;
        jaSpan.textContent = pair.ja;
        jaSpan.ondblclick = function() {
          groupData[groupId] = groupData[groupId].filter(p => p.id !== pair.id);
          renderPairs(groupId);
        };
        [enSpan, jaSpan].forEach(el => {
          el.addEventListener('mouseenter', () => highlight(el.dataset.id));
          el.addEventListener('mouseleave', () => unhighlight(el.dataset.id));
        });
        // å‰Šé™¤ãƒœã‚¿ãƒ³ã¯éè¡¨ç¤ºï¼ˆå¿…è¦ãªã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã§å¾©æ´»å¯ï¼‰
        // const delBtn = document.createElement('button');
        // delBtn.textContent = 'å‰Šé™¤';
        // delBtn.style.marginLeft = '0.5em';
        // delBtn.onclick = function() {
        //   groupData[groupId] = groupData[groupId].filter(p => p.id !== pair.id);
        //   renderPairs(groupId);
        // };
        pairDiv.appendChild(enSpan);
        pairDiv.appendChild(jaSpan);
        // pairDiv.appendChild(delBtn);
        outputDiv.appendChild(pairDiv);
      });
      // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ›ãƒœã‚¿ãƒ³ãƒ»ã‚¨ãƒªã‚¢ã®è¡¨ç¤ºåˆ¶å¾¡
      document.getElementById(`${groupId}-promptBtn`).style.display = groupData[groupId].length ? 'inline-block' : 'none';
      document.getElementById(`${groupId}-promptArea`).style.display = groupData[groupId].length ? 'block' : 'none';
    }
    // åˆæœŸåŒ–
    GROUPS.forEach(g => renderPairs(g.id));

    // --- ãƒã‚¤ãƒ©ã‚¤ãƒˆ ---
    function highlight(id) {
      document.querySelectorAll(`[data-id="${id}"]`).forEach(el => el.classList.add('highlight'));
    }
    function unhighlight(id) {
      document.querySelectorAll(`[data-id="${id}"]`).forEach(el => el.classList.remove('highlight'));
    }

    // --- è‹±æ–‡ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ› ---
    function showPrompt(groupId) {
      const prompt = groupData[groupId].map(p => p.en).join(', ');
      document.getElementById(`${groupId}-promptArea`).value = prompt;
    }

    // --- å…¨ãƒªã‚¹ãƒˆåˆæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ› ---
    function showAllPrompt() {
      const allWords = GROUPS.flatMap(g => groupData[g.id].map(p => p.en));
      document.getElementById('allPromptArea').value = allWords.join(', ');
    }
    // --- è‹±å˜èªã®è‰²åˆ†ã‘å‡¦ç† ---
    function highlightEnWord(text) {
      // ( ) ã‹ã£ã“éƒ¨åˆ†ã‚’ç·‘ã€ãƒ­ãƒ¼ãƒå­—ä»¥å¤–ã‚’é»’ã€ãƒ­ãƒ¼ãƒå­—ã¯é’
      // æ­£è¦è¡¨ç¾ã§åˆ†å‰²
      return text.replace(/([()])/g, '<span class="paren">$1</span>')
        .replace(/([^A-Za-z0-9\s.,:;\-\/\[\]{}'"!?<>@#$%^&*_+=~`|\\]+)/g, '<span class="non-latin">$1</span>');
    }
  </script>

</body>
</html>
